<div
    class="sm:inset-0 flex flex-col flex-auto min-w-0 sm:overflow-hidden bg-card dark:bg-transparent"
>   
    <div class="page-title justify-between flex">
        <span> {{ "PaymentTransactions.Allpaymenttransactions" | translate }}  <span *ngIf="mosqueName">: &ldquo;{{mosqueName.trim()}}&rdquo;</span></span>
        <div class="page-sub-title">
            <a class="mr-1 text-xl">{{ pageLength }}</a>
            <span class="float-right"> {{'PaymentTransactions.totalTransactions' | translate}}</span>
        </div>
    </div>   

    <div
        class="sm:inset-0 flex flex-col flex-auto min-w-0 sm:overflow-hidden bg-card dark:bg-transparent"
    >
        <div>
            <div
                class="flex flex-col sm:flex-row flex-0 sm:items-center sm:justify-between pb-4 px-6 md:px-4"
            >
                <div class="absolute inset-x-0 bottom-0" *ngIf="isLoading">
                    <mat-progress-bar
                        [mode]="'indeterminate'"
                    ></mat-progress-bar>
                </div>
                <div class="flex items-center gap-2 flex-nowrap w-full overflow-x-auto">
                    <form [formGroup]="searchForm" class="flex items-center gap-2 flex-nowrap">
                       <mat-form-field class="fuse-mat-dense fuse-mat-rounded w-42">
                            <mat-label>{{'PaymentTransactions.paymentChannel' | translate}}</mat-label>
                            <mat-select formControlName="paymentChannel">
                                <mat-option value="Virtual Account">{{'Filters.vAccount' | translate}}</mat-option>
                                <mat-option value="eWallets">{{'Filters.eWallet' | translate}}</mat-option>
                                <mat-option value="QRIS">{{'Filters.qrCode' | translate}}</mat-option>
                                <mat-option value="Retail Outlets (OTC)">{{'Filters.otc' | translate}}</mat-option>
                            </mat-select>
                        </mat-form-field>
                        <mat-form-field class="fuse-mat-dense fuse-mat-rounded w-42">
                            <mat-label>{{'PaymentTransactions.status' | translate}}</mat-label>
                            <mat-select formControlName="status">
                                <mat-option value="PAID">{{'Filters.paid' | translate}}</mat-option>
                                <mat-option value="PENDING">{{'Filters.pending' | translate}}</mat-option>
                            </mat-select>
                        </mat-form-field>

                        <div class="flex items-center gap-2">
                            <button mat-flat-button color="primary" (click)="SearchFilter()">
                                {{ 'RegUsers.search' | translate }}
                            </button>
                            <button mat-flat-button (click)="ResetFilterList()" style="background: beige;">
                                {{ 'RegUsers.reset' | translate }}
                            </button>
                        </div>
                    </form>
                    <div class="flex items-center ml-auto font-semibold" style="font-size: initial;">
                            <span>{{"PaymentTransactions.availablebalance" | translate}}:</span>
                            <span class="text-primary">{{ totalAvlAmount }}</span>    
                    </div>
                </div>                 
            </div>

            <div class="flex flex-auto overflow-hidden">
                <div
                    class="flex flex-col flex-auto overflow-hidden sm:overflow-y-auto sm:justify-between px-6 md:px-4"
                >
                    <table
                        mat-table
                        [dataSource]="dataSource"
                        multiTemplateDataRows
                        class="mat-elevation-z8 custom-table"
                    >
                        <ng-container matColumnDef="transactionId">
                            <th mat-header-cell *matHeaderCellDef>
                                {{
                                    "PaymentTransactions.transactionId"
                                        | translate
                                }}
                            </th>
                            <td mat-cell *matCellDef="let element">
                                {{ element.transactionId }}
                            </td>
                        </ng-container>
                        <ng-container matColumnDef="paymentMethod">
                            <th mat-header-cell *matHeaderCellDef>
                                {{
                                    "PaymentTransactions.paymentMethod"
                                        | translate
                                }}
                            </th>
                            <td mat-cell *matCellDef="let element">
                                {{ element.paymentMethod }}
                            </td>
                        </ng-container>
                        <ng-container matColumnDef="paymentGateway">
                            <th mat-header-cell *matHeaderCellDef>
                                {{
                                    "PaymentTransactions.paymentGateway"
                                        | translate
                                }}
                            </th>
                            <td mat-cell *matCellDef="let element">
                                Xendit
                            </td>
                        </ng-container>
                        <ng-container matColumnDef="currency">
                            <th mat-header-cell *matHeaderCellDef>
                                {{ "PaymentTransactions.currency" | translate }}
                            </th>
                            <td mat-cell *matCellDef="let element">
                                {{ element.currency }}
                            </td>
                        </ng-container>
                        <ng-container matColumnDef="paymentChannel">
                            <th mat-header-cell *matHeaderCellDef>
                                {{
                                    "PaymentTransactions.paymentChannel"
                                        | translate
                                }}
                            </th>
                            <td mat-cell *matCellDef="let element">
                                {{ element.paymentChannel }}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="amount">
                            <th mat-header-cell *matHeaderCellDef>
                                {{ "PaymentTransactions.amount" | translate }}
                            </th>
                            <td mat-cell *matCellDef="let element">
                                {{ element.amount }}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="paymentStatus">
                            <th mat-header-cell *matHeaderCellDef>
                                {{ "PaymentTransactions.status" | translate }}
                            </th>
                            <td mat-cell *matCellDef="let element">
                                {{ element.paymentStatus }}
                            </td>
                        </ng-container>
                        <!-- <ng-container matColumnDef="donatedBy">
                        <th mat-header-cell *matHeaderCellDef>{{
                            "PaymentTransactions.donatedBy" | translate
                        }}</th>
                        <td mat-cell *matCellDef="let element">
                            {{ element.donatedBy }}
                        </td>
                    </ng-container> -->
                        <ng-container matColumnDef="donationAmount">
                            <th mat-header-cell *matHeaderCellDef style="font-weight: 700;">
                                {{
                                    "PaymentTransactions.netamount" | translate
                                }}
                            </th>
                            <td mat-cell *matCellDef="let element" class="netAmount">
                                {{ element.donationAmount }}
                            </td>
                        </ng-container>
                        <!-- <ng-container matColumnDef="cashflow">
                        <th mat-header-cell *matHeaderCellDef>{{
                            "PaymentTransactions.cashflow" | translate
                        }}</th>
                        <td mat-cell *matCellDef="let element">
                            {{ element.cashflow }}
                        </td>
                    </ng-container> -->
                        <ng-container matColumnDef="paidAt">
                            <th mat-header-cell *matHeaderCellDef>
                                {{
                                    "PaymentTransactions.transactionDate"
                                        | translate
                                }}
                            </th>

                            <td
                                mat-cell
                                *matCellDef="let element"
                                class="colNumeric"
                            >
                                <div>
                                    {{ element.paidAt | date : "dd/MM/yyyy" }}
                                </div>
                                <div class="text-sm text-disabled">
                                    {{ element?.paidAt | date : "shortTime" }}
                                </div>
                            </td>
                        </ng-container>
                        <ng-container matColumnDef="action">
                            <th mat-header-cell *matHeaderCellDef>
                                {{ "PaymentTransactions.actions" | translate }}
                            </th>
                            <td mat-cell *matCellDef="let element">
                                <button (click)="onExpand(element)">
                                    <mat-icon
                                        *ngIf="expandedElement != element"
                                        [matTooltip]="
                                            'PaymentTransactions.view'
                                                | translate
                                        "
                                        >add</mat-icon
                                    >
                                    <mat-icon
                                        *ngIf="expandedElement === element"
                                        [matTooltip]="
                                            'PaymentTransactions.hide'
                                                | translate
                                        "
                                        >remove</mat-icon
                                    >
                                </button>

                                <!-- <mat-icon [matMenuTriggerFor]="menu">
                                more_vert
                            </mat-icon>

                            <mat-menu #menu="matMenu">
                                <button
                                    mat-menu-item
                                    (click)="onExpand(element)"
                                >
                                {{
                                    expandedElement === element
                                         ? ('PaymentTransactions.hide' | translate) : ('PaymentTransactions.view' | translate)                                          
                                }}
                                </button>
                               
                              
                            </mat-menu> -->
                            </td>
                        </ng-container>

                        <tr
                            mat-header-row
                            *matHeaderRowDef="displayedColumns"
                        ></tr>
                        <tr
                            mat-row
                            *matRowDef="let row; columns: displayedColumns"
                        ></tr>

                        <!-- Expanded Child Table -->
                        <tr
                            *matRowDef="let row; columns: []"
                            class="inner-row"
                            [style.display]="
                                expandedElement === row ? 'table-row' : 'none'
                            "
                        >
                            <td [attr.colspan]="displayedColumns.length">
                                <table
                                    mat-table
                                    [dataSource]="childData"
                                    class="child-table"
                                    *ngIf="expandedElement === row"
                                >
                                    <ng-container matColumnDef="donatedBy">
                                        <th mat-header-cell *matHeaderCellDef>
                                            {{
                                                "PaymentTransactions.donatedBy"
                                                    | translate
                                            }}
                                        </th>
                                        <td mat-cell *matCellDef="let element">
                                            {{ element.donatedBy }}
                                        </td>
                                    </ng-container>
                                    <ng-container matColumnDef="donationAmount">
                                        <th
                                            mat-header-cell
                                            *matHeaderCellDef
                                            style="text-align: center"
                                        >
                                            {{
                                                "PaymentTransactions.donationAmount"
                                                    | translate
                                            }}
                                            <br /><span>(A)</span>
                                        </th>
                                        <td mat-cell *matCellDef="let child">
                                            {{ child.donationAmount }}
                                        </td>
                                    </ng-container>

                                    <ng-container
                                        matColumnDef="transactionAmount"
                                    >
                                        <th
                                            mat-header-cell
                                            *matHeaderCellDef
                                            style="text-align: center"
                                        >
                                            {{
                                                "PaymentTransactions.transactionAmount"
                                                    | translate
                                            }}
                                            <br /><span>(B)</span>
                                        </th>
                                        <td mat-cell *matCellDef="let child">
                                            {{ child.transactionAmount }}
                                        </td>
                                    </ng-container>
                                    <ng-container matColumnDef="vatAmount">
                                        <th
                                            mat-header-cell
                                            *matHeaderCellDef
                                            style="text-align: center"
                                        >
                                            {{
                                                "PaymentTransactions.vatAmount"
                                                    | translate
                                            }}
                                            <br /><span>(C)</span>
                                        </th>
                                        <td mat-cell *matCellDef="let child">
                                            {{ child.vatAmount }}
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="serviceAmount">
                                        <th
                                            mat-header-cell
                                            *matHeaderCellDef
                                            style="text-align: center"
                                        >
                                            {{
                                                "PaymentTransactions.serviceAmount"
                                                    | translate
                                            }}
                                            <br /><span>(D)</span>
                                        </th>
                                        <td mat-cell *matCellDef="let child">
                                            {{ child.serviceAmount }}
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="paidAmount">
                                        <th
                                            mat-header-cell
                                            *matHeaderCellDef
                                            style="text-align: center"
                                        >
                                            {{
                                                "PaymentTransactions.paidAmount"
                                                    | translate
                                            }}
                                            <br /><span>(Z)=(A+B+C+D)</span>
                                        </th>
                                        <td mat-cell *matCellDef="let child">
                                            {{ child.paidAmount }}
                                        </td>
                                    </ng-container>

                                    <tr
                                        mat-header-row
                                        *matHeaderRowDef="[
                                            'donatedBy',
                                            'donationAmount',
                                            'transactionAmount',
                                            'vatAmount',
                                            'serviceAmount',
                                            'paidAmount'
                                        ]"
                                    ></tr>
                                    <tr
                                        mat-row
                                        *matRowDef="
                                            let child;
                                            columns: [
                                                'donatedBy',
                                                'donationAmount',
                                                'transactionAmount',
                                                'vatAmount',
                                                'serviceAmount',
                                                'paidAmount'
                                            ]
                                        "
                                    ></tr>
                                </table>
                            </td>
                        </tr>
                        <tr class="mat-row" *matNoDataRow>
                            <td class="mat-cell" colspan="4">
                                {{
                                    "productThreshold.noDataMatching"
                                        | translate
                                }}
                            </td>
                        </tr>
                    </table>
                    <mat-paginator #paginator [length]="pageLength" [pageSize]="pageSize" [showFirstLastButtons]="true"
                        showFirstLastButtons [pageSizeOptions]="[10,20, 50]" (page)="onPageChange($event)">
                    </mat-paginator>
                </div>
            </div>
        </div>
    </div>
</div>
